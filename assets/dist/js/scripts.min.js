"use strict";!function(m,e,s,n){e.xbeeCreateDropzone=function(o){var e=".xbee-document #xbee-dropzone-"+o.id;function r(e,s){var n='<div class="xbee-message">'+s+"</div>";(!(2<arguments.length&&void 0!==arguments[2])||arguments[2])&&(n+='<span class="xbee-close"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path fill="'+xbeeDocumentParams.primaryColor+'" fill-rule="evenodd" d="M16 1.6L14.4 0 8 6.4 1.6 0 0 1.6 6.4 8 0 14.4 1.6 16 8 9.6l6.4 6.4 1.6-1.6L9.6 8z"/></svg></span>'),m(e).find(".xbee-response").css("display","table").html("").append(n),m(e).find(".xbee-response .xbee-close").on("click",function(){m(e).find(".xbee-response").css("display","none").html("")})}function c(e,s){for(var n=m(e).find(".xbee-response .xbee-progress-percent .xbee-percent"),i=m(e).find(".xbee-response .xbee-progress-bar .xbee-progress"),a=parseInt(m(n).html()),t=a+s,o=function(e){setTimeout(function(){m(n).html(e),m(i).css("width",e+"%")},300)},r=a;r<=t;r++)o(r)}var s='<img src="'+xbeeDocumentParams.images.iconDelete+'" />',l='<img class="icon-xcoobee" src="'+xbeeDocumentParams.images.iconXcooBee+'" />',d='<img class="icon-error" src="'+xbeeDocumentParams.images.iconError+'" />',u=(xbeeDocumentParams.images.loader,'<div class="xbee-progress-bar"><div class="xbee-progress" style="background-color:'+xbeeDocumentParams.primaryColor+';"></div></div>');new Dropzone(e,{paramName:"files",uploadMultiple:!0,autoProcessQueue:!1,previewsContainer:e+" .xbee-previews",clickable:e+" .btn-browse",addRemoveLinks:!0,thumbnailHeight:40,thumbnailWidth:40,acceptedFiles:o.acceptedFiles,url:xbeeDocumentParams.ajaxUrl,dictRemoveFile:s,dictCancelUpload:s,previewTemplate:'<div class="xbee-preview"><div class="xbee-image"><img data-dz-thumbnail /></div><div class="xbee-details"><div class="xbee-filename"><span data-dz-name></span></div><div class="xbee-size" data-dz-size></div></div></div>',init:function(){var i=this,a=m(i.element),t=[];m(a).on("submit",function(e){if(e.preventDefault(),e.stopPropagation(),r(a,'<div class="xbee-progress-percent"><span class="xbee-percent">0</span>%</div>'+u,!1),-1!==o.beesRequireFileUpload.indexOf(o.beeName)){if(0===i.getQueuedFiles().length){var s=d+"<p>"+xbeeDocumentParams.messages.errorSendNoFiles+"</p>";return void r(a,s,!0)}if(0===t.length){var n={action:"xbee_document_send",files:i.files.map(function(e){return e.name})};c(a,25),m.ajax({url:xbeeDocumentParams.ajaxUrl,method:"post",data:n,success:function(e){if(200===e.code){var s=Object.values(e.result);c(m(i.element),25),XcooBee.sdk.Utilities.uploadFiles(i.files,s).then(function(){c(m(i.element),25),m.ajax({url:xbeeDocumentParams.ajaxUrl,method:"post",data:{action:"xbee_document_upload",files:i.files.map(function(e){return e.name}),data:m(a).serialize()},success:function(e){if(i.removeAllFiles(!0),m(a)[0].reset(),"success"===e.status){c(m(i.element),25);var s=l+"<p>"+o.successText+"</p>";r(a,s,!0)}else{var n=d+"<p>"+xbeeDocumentParams.messages.errorSendFiles+"</p>";r(a,n,!0)}},error:function(){}})}).catch(function(e){return console.error(e)})}else console.error(e)},error:function(){}})}else t.forEach(function(e){console.log(e)})}else c(a,25),m.ajax({url:xbeeDocumentParams.ajaxUrl,method:"post",data:{action:"xbee_document_upload",data:m(a).serialize()},success:function(e){if(i.removeAllFiles(!0),m(a)[0].reset(),c(m(i.element),25),"success"===e.status){c(m(i.element),50);var s=l+"<p>"+o.successText+"</p>";r(a,s,!0)}else{var n=d+"<p>"+xbeeDocumentParams.messages.errorSendFiles+"</p>";r(a,n,!0)}},error:function(){}})}),this.on("addedfile",function(e){var s="."+e.name.split(".").pop().toLowerCase(),n=o.acceptedFiles.split(",").map(function(e){return e.toLowerCase()});if(0<n.length&&!n.includes(s)){n=n.split(","),this.removeFile(e);var i=d+"<p>"+xbeeDocumentParams.messages.errorAcceptedFileExtensions+" "+n.join(", ")+"</p>";r(a,i,!0)}}),this.on("sending",function(e,s,n){n.append("xbee_bee_name",o.beeName)})}})},m(s).ready(function(){m(".xbee-document").each(function(){m(this);var e=m(this).find(".xbee-dropzone"),s=m(this).find(".xbee-actions").outerHeight();e.css("padding",parseInt(s+15)+"px"),m(this).on("DOMSubtreeModified",".xbee-dropzone",function(){e.find(".xbee-response").css("width",e.innerWidth()+"px"),e.find(".xbee-response").css("height",e.innerHeight()+"px")})})})}(jQuery,window,document);